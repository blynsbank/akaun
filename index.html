<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blyns Bank - Laman Utama</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        :root {--primary-color: #0d9488; --primary-light: #2dd4bf;}
        body {font-family: 'Inter', sans-serif; background-color:#000; margin:0; display:flex; justify-content:center; min-height:100vh;}
        .app-container {width:100%; max-width:420px; background:#0a0a0a; position:relative; color:white; overflow:hidden;}
        .blob {position:absolute; border-radius:50%; filter:blur(80px); z-index:0; opacity:0.3; pointer-events:none;}
        .blob-1 {top:-10%; left:-20%; width:300px; height:300px; background:#0d9488;}
        .blob-2 {bottom:-10%; right:-20%; width:250px; height:250px; background:#3b82f6;}
        .black-header {background-color:#000; border-bottom:1px solid rgba(255,255,255,0.1); box-shadow:0 4px 20px rgba(0,0,0,0.5);}
        .balance-card {background:linear-gradient(135deg,#0f766e 0%,#10b981 100%); box-shadow:0 15px 30px -8px rgba(13,148,136,0.7); position:relative; z-index:10;}
        .action-tile {background: rgba(255,255,255,0.05); transition: all 0.2s ease; border:1px solid rgba(255,255,255,0.1);}
        .action-tile:hover {background: rgba(13,148,136,0.1); border-color:var(--primary-color); transform:translateY(-2px); box-shadow:0 5px 15px rgba(13,148,136,0.2);}
        .pay-rect {background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border:1px solid rgba(255,255,255,0.3); box-shadow:0 4px 10px rgba(0,0,0,0.2);}
        button {background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.15); padding:10px 16px; border-radius:12px; color:white; font-weight:500; transition:.2s;}
        button:hover {background: rgba(255,255,255,0.12); border-color: var(--primary-light); transform:translateY(-2px); box-shadow:0 4px 12px rgba(45,212,191,0.2);}
        .btn-primary {background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.15); padding:12px 18px; border-radius:16px; color:white; font-weight:600; transition:all 0.25s ease; backdrop-filter:blur(4px);}
        .btn-primary:hover {background: rgba(255,255,255,0.12); border-color:var(--primary-light); transform:translateY(-2px); box-shadow:0 6px 18px rgba(45,212,191,0.25);}
    </style>
</head>

<body>
    <div class="app-container">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>

        <header class="black-header sticky top-0 z-20 px-6 py-4 flex items-center justify-between">
            <img src="https://i.postimg.cc/QdHXM5RS/Blyns-Bank-Head-Logo.png" alt="Blyns Bank" class="h-10 w-auto">
            <button id="btnLogout" onclick="handleLogout()" class="text-gray-400 hover:text-red-500 transition duration-150 p-2 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <path d="M16 17l5-5-5-5"/>
                    <path d="M21 12H9"/>
                </svg>
            </button>
        </header>

        <main class="p-6 relative z-10">
            <div class="mb-6">
                <p class="text-lg text-gray-400 font-light">Selamat Datang,</p>
                <h1 class="text-3xl font-bold text-white tracking-tight">Pengguna</h1>
            </div>

            <div class="balance-card p-6 rounded-2xl mb-8">
                <div class="flex justify-between items-center mb-1">
                    <p class="text-white text-sm opacity-80">Baki Semasa</p>
                    <button id="btnToggleBalance" class="text-white opacity-90 p-1 hover:opacity-100 transition">
                        <svg id="iconEye" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                        <svg id="iconEyeOff" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" class="hidden"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.78 9.78 0 0 0 5.46-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></svg>
                    </button>
                </div>

                <h2 class="text-4xl font-extrabold text-white tracking-wide mb-4">
                    RM <span id="currentBalance">00.00</span>
                </h2>

                <div class="flex justify-between items-center mb-6">
                    <p class="text-xs text-white opacity-70">
                        <span id="accountNumberShown">xxxxxxxxxx</span>
                        <span id="accountNumberHidden" class="hidden">xxxxxxxxxx</span>
                    </p>
                </div>

                <div class="pay-rect w-full py-3 px-4 rounded-xl flex items-center justify-between text-white font-semibold cursor-pointer" onclick="handleTileClick('Bayar')">
                    <span class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 5v2"/><path d="M19 17v2"/><path d="M5 17v2"/><path d="M5 5v2"/><path d="M12 18v-5"/><path d="M12 13V6"/></svg>
                        Bayar
                    </span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button class="action-tile p-5 rounded-2xl text-center flex flex-col items-center" onclick="handleTileClick('Tambah Wang')">
                    <div class="p-3 mb-2 rounded-full bg-teal-600/20 text-teal-400"></div>
                    <span class="text-sm font-semibold text-white mt-1">Tambah Wang</span>
                </button>
                <button class="action-tile p-5 rounded-2xl text-center flex flex-col items-center" onclick="handleTileClick('Pindah')">
                    <div class="p-3 mb-2 rounded-full bg-teal-600/20 text-teal-400"></div>
                    <span class="text-sm font-semibold text-white mt-1">Pindahkan Wang</span>
                </button>
                <button class="action-tile p-5 rounded-2xl text-center flex flex-col items-center" onclick="handleTileClick('Aktifkan')">
                    <div class="p-3 mb-2 rounded-full bg-teal-600/20 text-teal-400"></div>
                    <span class="text-sm font-semibold text-white mt-1">Aktivasi</span>
                </button>
                <button class="action-tile p-5 rounded-2xl text-center flex flex-col items-center" onclick="handleTileClick('Akaun Saya')">
                    <div class="p-3 mb-2 rounded-full bg-teal-600/20 text-teal-400"></div>
                    <span class="text-sm font-semibold text-white mt-1">Akaun Saya</span>
                </button>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBpIKSxSnYfvBQia3rlOseBtnSVqThX18c",
            authDomain: "superblyns.firebaseapp.com",
            projectId: "superblyns",
            storageBucket: "superblyns.appspot.com",
            messagingSenderId: "1089867637612",
            appId: "1:1089867637612:web:551d76367b4cfbb6fd4949"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const balanceSpan = document.getElementById('currentBalance');
        const accountNumberShown = document.getElementById('accountNumberShown');
        const accountNumberHidden = document.getElementById('accountNumberHidden');
        const welcomeName = document.querySelector('main h1');
        const btnToggleBalance = document.getElementById('btnToggleBalance');

        let userBalance = "0.00";
        let activated = false;
        let isBalanceHidden = false;

        async function handleLogout() {
            await signOut(auth);
            window.location.href = "https://blynsbank.github.io/logmasuk/";
        }
        window.handleLogout = handleLogout;

        window.handleTileClick = (actionName) => {
            const blockedTiles = ["Bayar", "Tambah Wang", "Pindah"];
            if (!activated && blockedTiles.includes(actionName)) {
                alert("Akaun belum aktif. Tile ini tidak boleh digunakan.");
                return;
            }
            const urls = {
                "Bayar": "https://blynsbank.github.io/bayar/",
                "Tambah Wang": "https://blynsbank.github.io/tambahwang/",
                "Pindah": "https://blynsbank.github.io/pindahwang/",
                "Aktifkan": "https://blynsbank.github.io/aktivasi/",
                "Akaun Saya": "https://blynsbank.github.io/akaunsaya/"
            }
            window.location.href = urls[actionName] || "https://blynsbank.github.io/error/";
        };

        btnToggleBalance?.addEventListener('click', () => {
            isBalanceHidden = !isBalanceHidden;
            balanceSpan.textContent = isBalanceHidden ? "XXXXX.XX" : userBalance;
            accountNumberShown.classList.toggle('hidden', isBalanceHidden);
            accountNumberHidden.classList.toggle('hidden', !isBalanceHidden);
        });

        onAuthStateChanged(auth, async (user) => {
            if (!user) { window.location.href = "https://blynsbank.github.io/logmasuk/"; return; }
            try {
                const ref = doc(db, "users", user.uid);
                const snap = await getDoc(ref);
                if (!snap.exists()) { await handleLogout(); return; }
                const data = snap.data();
                userBalance = data.balance || "0.00";
                activated = data.activated || false;
                welcomeName.textContent = data.name || "Pengguna";
                balanceSpan.textContent = userBalance;
                accountNumberShown.textContent = data.cardnumber || "xxxxxxxxxx";
                accountNumberHidden.textContent = data.cardnumber || "xxxxxxxxxx";
            } catch(err) { console.error(err); await handleLogout(); }
        });
    </script>
</body>

</html>
